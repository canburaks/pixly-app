kages:
  yum:
    mod24_ssl : []
    
files:
  /etc/httpd/conf.d/ssl.conf:
    mode: "000644"
    owner: root
    group: root
    content: |
      LoadModule wsgi_module modules/mod_wsgi.so
      WSGIPythonHome /opt/python/run/baselinenv
      WSGISocketPrefix run/wsgi
      WSGIRestrictEmbedded On
      Listen 443
      <VirtualHost *:443>
        SSLEngine on
        SSLCertificateFile "/etc/pki/tls/certs/server.crt"
        SSLCertificateKeyFile "/etc/pki/tls/certs/server.key"
        
        Alias /static/ /opt/python/current/app/static/
        <Directory /opt/python/current/app/static>
        Order allow,deny
        Allow from all
        </Directory>
        
        WSGIScriptAlias / /opt/python/current/app/djaws/wsgi.py
        
        <Directory /opt/python/current/app>
        Require all granted
        </Directory>
        
        WSGIDaemonProcess wsgi-ssl processes=1 threads=15 display-name=%{GROUP} \
          python-path=/opt/python/current/app \
          python-home=/opt/python/run/venv \
          home=/opt/python/current/app \
          user=wsgi \
          group=wsgi
        WSGIProcessGroup wsgi-ssl
        
      </VirtualHost>
      
  /etc/pki/tls/certs/server.crt:
    mode: "000400"
    owner: root
    group: root
    content: |
      -----BEGIN CERTIFICATE-----
      MIIFqjCCBJKgAwIBAgIQAswg6nuShRyVFrm1yWNtfzANBgkqhkiG9w0BAQsFADBG
      MQswCQYDVQQGEwJVUzEPMA0GA1UEChMGQW1hem9uMRUwEwYDVQQLEwxTZXJ2ZXIg
      Q0EgMUIxDzANBgNVBAMTBkFtYXpvbjAeFw0xOTA4MDcwMDAwMDBaFw0yMDA5MDcx
      MjAwMDBaMBQxEjAQBgNVBAMTCXBpeGx5LmFwcDCCASIwDQYJKoZIhvcNAQEBBQAD
      ggEPADCCAQoCggEBAKwQWdGy2uPKr+tarKUFeFk7kenWwArByBirPUF/OYqzxn4v
      /XevptpSvh3XsT/hlaFFWySzs58dHc9Viwj+zexxt8G3D/3XjHYve/bB1hEIBbvg
      Czoj1DdWu9Ao66DTkQGEV0OGfNE9DG1iV56+cVOs/ZQlZ6yrjzMuVYce4jOl5WGO
      ITxmgYTSMcGL/CqPOmu+w13RgKrJ3yLhG/CbX8yJQs8zyLEF/KsZOX8d4qksxe2n
      4gkuW2SY/36Ddh24XzObEq7c0J6PrvNp2MGNJCROTiHrrKX98esiwbqyIQaLWWED
      9DSfNao7aRmQE6y6CdWscOucH7gVaCE7mXBgRm8CAwEAAaOCAsQwggLAMB8GA1Ud
      IwQYMBaAFFmkZgZSoHuVkjyjlAcnlnRb+T3QMB0GA1UdDgQWBBSKAL5qY0RAlEjo
      R/oknH3fgsEs8DBjBgNVHREEXDBagglwaXhseS5hcHCCECouYmxvZy5waXhseS5h
      cHCCDmJsb2cucGl4bHkuYXBwggsqLnBpeGx5LmFwcIIPKi53d3cucGl4bHkuYXBw
      gg13d3cucGl4bHkuYXBwMA4GA1UdDwEB/wQEAwIFoDAdBgNVHSUEFjAUBggrBgEF
      BQcDAQYIKwYBBQUHAwIwOwYDVR0fBDQwMjAwoC6gLIYqaHR0cDovL2NybC5zY2Ex
      Yi5hbWF6b250cnVzdC5jb20vc2NhMWIuY3JsMCAGA1UdIAQZMBcwCwYJYIZIAYb9
      bAECMAgGBmeBDAECATB1BggrBgEFBQcBAQRpMGcwLQYIKwYBBQUHMAGGIWh0dHA6
      Ly9vY3NwLnNjYTFiLmFtYXpvbnRydXN0LmNvbTA2BggrBgEFBQcwAoYqaHR0cDov
      L2NydC5zY2ExYi5hbWF6b250cnVzdC5jb20vc2NhMWIuY3J0MAwGA1UdEwEB/wQC
      MAAwggEEBgorBgEEAdZ5AgQCBIH1BIHyAPAAdQDuS723dc5guuFCaR+r4Z5mow9+
      X7By2IMAxHuJeqj9ywAAAWxsa2ntAAAEAwBGMEQCIG2/jSEqqvPYeHCtQ9ru96Gi
      jD2QkYNs7aCFjKiAts/zAiA4G3thRGp2bF2THDnsgcKnM/eBWofEfF5Yfe8HtLRA
      cQB3AId1v+dZfPiMQ5lfvfNu/1aNR1Y2/0q1YMG06v9eoIMPAAABbGxrajwAAAQD
      AEgwRgIhAOb456C+jcgkqPstu/0wMG19khbuIUFmEOxlwxRH3p3+AiEA/DpqmPdE
      GmnqY4MWFtHKbCx3ZSvzdEGbknUF3ChagMUwDQYJKoZIhvcNAQELBQADggEBAJsB
      p/QFbsYq/DGVq5xv/JQFFnM2xePrRKsdUktREXizBNtvNVt725TyjJH/HBO+ek3L
      IKlqnkFWq/ShgiBYYfqtXvybz5HXgPtz4qRiZ6zpCWHatOz/mkRtJLxh3+8//oyN
      rEhf4cgqo83zckrd/47wI8V5bKDzETwFVfYW6dE1uFL3/MxPpZh/Vl17lenoSr3v
      uPkJyPz8fUGBbKJQ0W7bZN3vR4nZaLKmBNfHmp5kj5AMJPubpHZA3mRVC3V21wPe
      OlmekEjKasN+VLBlCxqM30eJ6/mpZPyY5VHUMmbN9Ba60Wh43ixLoQGgyVJvh5r0
      WUeWHeR6UM3TZQ6Utq8=
      -----END CERTIFICATE-----
       
  /etc/pki/tls/certs/server.key:
    mode: "000400"
    owner: root
    group: root
    content: |
      -----BEGIN RSA PRIVATE KEY-----
      MIIEpAIBAAKCAQEAv1+R6X/5BRvf3VCIMk6+DVp7MIxR9vmuI1Z79QcmCyf/ykZgh42Fck3NK8VL
      xnjE/5Pr6ENKE8U4gciUiV5p9thB93IL8V9Sm+u/uGWuq8H89K9u4vDOa+e/tXHkZxbL+yTyhiDx
      WWTWY2v0Da/j4l0Mr9TMcBlXzB7zwJuc1tWLNtvVBFPMkiePNP03gf9wliHT//0V0VepeQKKjqrc
      QetHxc0guKTqu2OcRiBEy7AlfUDIDkyoBZ/f5UuLyJc2kQrtlCKmMsQIA/WorK8N+sa8PsG59aH3
      cmnngH/1wUgIFjxzQ+c/IExAIteN99p1Qw55vd8hphMiPFFZ24Rh1QIDAQABAoIBAAgyWLaOk6Tj
      X8BD7cFx2/QIdxRKPkx8vzemQaLqDngV23/XadUEe728lVgVmDxE+fMUa9tD3o1gOh5c7/e+Qn2f
      H5wwl1BcS9Z/z3Nfb47NvT7hsLcppz257F0iJq0/rbbxCy4xhQTWK9SQUCCx8unEIIH7dFIs07Tb
      codCYwJUif437B1OSKkpwfjo03ZkGNesiz+w66vwqbI1DgZjDe5KUiQzUWLjDVnIYk/gPARmTz5P
      n2LifrYQvECI0Olh+VGtWiLOBYys4NVFWgh1Y1Lcow1+VPMilfGeDSK4if+Jn5pzuL2D7sWCrKeU
      tvh4o9u7QRzOOQZP6IS0nykeTUECgYEA/wXylmAitnk/ei1QMc2jICG+yI9wIEojjZgckomJw8l3
      h81+1wY1yEgV+orGl1Io5EzcSEXu3frrgYKrBVQiYj/JBPvgJ1YlQL/CrIh8ts29unAxGqOn55/N
      pO+4YDuHtcPG1ZiPdYEJHfGRtBgN9UlhsixRlYBCSIODu5bI6mUCgYEAwBs2jWr5AEJ0s3nJQrKq
      /8NU0w5nQpr2rELHfJXbewbibZF7GuR2l2J0kNYFsRCeLbTrUjoyDL/hHoUvlAaR8xV1ukAlR3CC
      L61tggqH6BIidbX/NU11iklanj4ue+NbiDb6ekMKDvw/A7VML0/remDP/0lh+BSVxJk8KmBS6rEC
      gYEAmd2HyMzGBNxQvTFbwkC03C0gA7fvSbwRiVuuWYdcNGF4mdoVXjyj9GvxvtE+EoyCmYP6ICz5
      errqnqAs+TES8b5UVYp2aqViIpfQJ/LNdCncAAGyzsTRCEH1fD8aOg2Qys0NSVAbtiSdUJCwfT1K
      JqUYqbxtmMrisweOUn8eR7UCgYAh2mnRoAFDP3LLUfHalBu4OJbRHp+pyB8iGh6HYO0tj/gE8Pct
      tQcFBG+gOmcEXfZR/ajec6zwPDwSocvRnRrJKIX3jWhEX5pBhqFeojZy+gcikTDpFr5Y4TZb3n9Y
      i6dMqMuZEglKvL7qC1/ikoXfqgHdbfQawJ3n6E0G9rSF8QKBgQDUeNAAYZgM9esCa9Tnyq+4YhpW
      l6m5rL0Uh681aNmpjAR2Lw8WkD9D2ZuAdujT3c6BQ+Mdvt3CzzlO/nEnZLLINT7Wt149tXv3mf4b
      cU1hPD8FNqGBj5LeJwkNyTvOLS0TjvuSOS8Wfsr3bu3aiS1bMn7XuZX2O3Ibz5+HzjS5Ig==
      -----END RSA PRIVATE KEY-----
      
container_commands:
  01killhttpd:
    command: "killall httpd"
  02waitforhttpddeath:
    command: "sleep 3"