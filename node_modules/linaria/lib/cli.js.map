{"version":3,"sources":["../src/cli.js"],"names":["path","require","normalize","fs","mkdirp","glob","yargs","transform","usage","option","alias","type","description","requiresArg","demandOption","default","implies","strict","argv","processFiles","_","outDir","sourceMaps","sourceRoot","insertCssRequires","configFile","config","files","options","count","resolvedFiles","reduce","acc","pattern","sync","absolute","forEach","filename","outputFilename","resolveOutputFilename","readFileSync","toString","pluginOptions","cssText","sourceMap","cssSourceMapText","dirname","cssContent","writeFileSync","inputFilename","resolve","relative","relativePath","requireStatement","startsWith","inputContent","trim","endsWith","console","log","folderStructure","process","cwd","outputBasename","basename","replace","extname","join"],"mappings":"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","sourcesContent":["/* @flow */\n\nconst path = require('path');\nconst normalize = require('normalize-path');\nconst fs = require('fs');\nconst mkdirp = require('mkdirp');\nconst glob = require('glob');\nconst yargs = require('yargs');\nconst transform = require('./transform');\n\nconst { argv } = yargs\n  .usage('Usage: $0 [options] <files ...>')\n  .option('config', {\n    alias: 'c',\n    type: 'string',\n    description: 'Path to a config file',\n    requiresArg: true,\n  })\n  .option('out-dir', {\n    alias: 'o',\n    type: 'string',\n    description: 'Output directory for the extracted CSS files',\n    demandOption: true,\n    requiresArg: true,\n  })\n  .option('source-maps', {\n    alias: 's',\n    type: 'boolean',\n    description: 'Generate source maps for the CSS files',\n    default: false,\n  })\n  .option('source-root', {\n    alias: 'r',\n    type: 'string',\n    description: 'Directory containing the source JS files',\n    requiresArg: true,\n  })\n  .option('insert-css-requires', {\n    alias: 'i',\n    type: 'string',\n    description:\n      'Directory containing JS files to insert require statements for the CSS files',\n    requiresArg: true,\n  })\n  .implies('insert-css-requires', 'source-root')\n  .alias('help', 'h')\n  .alias('version', 'v')\n  .strict();\n\nprocessFiles(argv._, {\n  outDir: argv['out-dir'],\n  sourceMaps: argv['source-maps'],\n  sourceRoot: argv['source-root'],\n  insertCssRequires: argv['insert-css-requires'],\n  configFile: argv.config,\n});\n\ntype Options = {\n  outDir: string,\n  sourceMaps?: boolean,\n  sourceRoot?: string,\n  insertCssRequires?: string,\n  configFile?: string,\n};\n\nfunction processFiles(files: string[], options: Options) {\n  let count = 0;\n\n  const resolvedFiles = files.reduce(\n    (acc, pattern) => [...acc, ...glob.sync(pattern, { absolute: true })],\n    []\n  );\n\n  resolvedFiles.forEach(filename => {\n    const outputFilename = resolveOutputFilename(filename, options.outDir);\n\n    const { cssText, sourceMap, cssSourceMapText } = transform(\n      fs.readFileSync(filename).toString(),\n      {\n        filename,\n        outputFilename,\n        pluginOptions: {\n          configFile: options.configFile,\n        },\n      }\n    );\n\n    if (cssText) {\n      mkdirp.sync(path.dirname(outputFilename));\n\n      const cssContent =\n        options.sourceMaps && sourceMap\n          ? `${cssText}\\n/*# sourceMappingURL=${outputFilename}.map */`\n          : cssText;\n\n      fs.writeFileSync(outputFilename, cssContent);\n\n      if (\n        options.sourceMaps &&\n        sourceMap &&\n        typeof cssSourceMapText !== 'undefined'\n      ) {\n        fs.writeFileSync(`${outputFilename}.map`, cssSourceMapText);\n      }\n\n      if (options.insertCssRequires && options.sourceRoot) {\n        const inputFilename = path.resolve(\n          options.insertCssRequires,\n          path.relative(options.sourceRoot, filename)\n        );\n\n        const relativePath = normalize(\n          path.relative(path.dirname(inputFilename), outputFilename)\n        );\n\n        const requireStatement = `\\nrequire('${\n          relativePath.startsWith('.') ? relativePath : `./${relativePath}`\n        }');`;\n\n        const inputContent = fs.readFileSync(inputFilename, 'utf-8');\n\n        if (!inputContent.trim().endsWith(requireStatement)) {\n          fs.writeFileSync(\n            inputFilename,\n            `${inputContent}\\n${requireStatement}\\n`\n          );\n        }\n      }\n\n      count++;\n    }\n  });\n\n  console.log(`Successfully extracted ${count} CSS files.`);\n}\n\nfunction resolveOutputFilename(filename: string, outDir: string) {\n  const folderStructure = path.relative(process.cwd(), path.dirname(filename));\n  const outputBasename = path\n    .basename(filename)\n    .replace(path.extname(filename), '.css');\n\n  return path.join(outDir, folderStructure, outputBasename);\n}\n"],"file":"cli.js"}